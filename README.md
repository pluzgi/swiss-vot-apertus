# Swiss Voting Assistant - Standalone Edition

A comprehensive RAG-powered assistant for Swiss popular initiatives (Volksabstimmungen), built with OpenWebUI, FastAPI, and Swisscom Apertus.

## ğŸ¯ Overview

The Swiss Voting Assistant makes complex voting information accessible through a conversational AI interface. It provides instant access to details about Swiss popular initiatives, arguments from both sides, and official sources with full attribution - powered by RAG (Retrieval-Augmented Generation).

**Problem:** Swiss citizens receive lengthy voting brochures that are time-consuming and difficult to navigate.

**Solution:** An intelligent chat interface that retrieves relevant information from voting brochures on-demand, with answers generated by Swisscom's Apertus 70B model.

---

## âœ¨ Features

âœ… **Conversational Interface** - Natural language queries via OpenWebUI
âœ… **RAG-Powered Answers** - Semantic search through brochure texts using ChromaDB
âœ… **Multilingual Support** - German, French, and Italian
âœ… **Comprehensive Data** - Metadata, party positions, parliamentary votes
âœ… **Official Sources** - Pre-extracted brochure texts with PDF links
âœ… **Swiss AI** - Powered by Swisscom Apertus 70B model

---

## ğŸ—ï¸ Architecture

```
User Query (OpenWebUI)
        â†“
  FastAPI Backend (Pipeline)
        â†“
  RAG Pipeline (LangChain)
        â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚             â”‚              â”‚
ChromaDB    PostgreSQL   Apertus API
(Vector)     (Metadata)    (LLM 70B)
  â”‚             â”‚              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“
  Enriched Response
        â†“
  Display in OpenWebUI
```

### Tech Stack

| Component | Technology |
|-----------|------------|
| **Frontend** | OpenWebUI (Docker) |
| **Backend** | FastAPI + Python 3.11 |
| **Database** | Railway PostgreSQL (cloud) |
| **Vector Store** | ChromaDB (Docker) |
| **LLM** | Swisscom Apertus 70B |
| **RAG** | LangChain + sentence-transformers |
| **Orchestration** | Docker Compose |

---

## ğŸš€ Quick Start

### Prerequisites

- Docker Desktop (running)
- Swisscom Apertus API key
- 8GB+ RAM

### 1. Clone & Configure

```bash
git clone <repository>
cd Swiss-Vot-Apertus

# Copy environment template
cp .env.example .env

# Edit .env and add your API key
nano .env  # Set APERTUS_API_KEY=your_key_here
```

### 2. Start Services

```bash
# Start all containers
docker-compose up -d

# View logs
docker-compose logs -f
```

### 3. Access Applications

- **OpenWebUI**: http://localhost:3000
- **API Documentation**: http://localhost:8000/docs
- **Health Check**: http://localhost:8000/health

### 4. Test Setup

```bash
./test-setup.sh
```

---

## ğŸ“‚ Project Structure

```
Swiss-Vot-Apertus/
â”œâ”€â”€ docker-compose.yml          # Multi-service orchestration
â”œâ”€â”€ .env.example                # Environment template
â”œâ”€â”€ SETUP.md                    # Detailed setup guide
â”œâ”€â”€ STEP1-COMPLETE.md           # Migration progress
â”‚
â”œâ”€â”€ backend/                    # FastAPI Application
â”‚   â”œâ”€â”€ main.py                 # API endpoints & OpenWebUI Pipeline
â”‚   â”œâ”€â”€ config.py               # Configuration management
â”‚   â”œâ”€â”€ requirements.txt        # Python dependencies
â”‚   â””â”€â”€ Dockerfile              # Container definition
â”‚
â”œâ”€â”€ data/                       # Voting Data
â”‚   â””â”€â”€ current_votes.json      # Swiss initiatives (auto-updated)
â”‚
â”œâ”€â”€ scripts/                    # Data Pipeline
â”‚   â”œâ”€â”€ extract_voting_data.py  # Web scraper
â”‚   â””â”€â”€ validate_voting_data.py # Data validation
â”‚
â””â”€â”€ .github/workflows/          # Automation
    â””â”€â”€ update_initiatives.yml  # Weekly data updates
```

---

## ğŸ”§ Development

### Local Backend Development

```bash
cd backend

# Create virtual environment
python3.11 -m venv venv
source venv/bin/activate

# Install dependencies
pip install -r requirements.txt

# Run locally (outside Docker)
uvicorn main:app --reload --port 8000
```

### Database Migration (Production)

```bash
# Connect to Railway PostgreSQL
# Update DATABASE_URL in .env with Railway credentials

# Run migration
python scripts/migrate_data.py
```

### Vector Store Indexing

```bash
# Index brochure texts in ChromaDB
python scripts/index_brochures.py
```

---

## ğŸ“Š Data Sources

**Primary Source:** [swissvotes.ch](https://swissvotes.ch)
**Update Frequency:** Weekly (via GitHub Actions)
**Languages:** German, French, Italian

### Official Sources
- **swissvotes.ch** - Historical voting data and metadata
- **admin.ch** - Current voting information
- **Bundesblatt** - Federal gazette

### Data Includes
- Initiative metadata (title, ID, date, initiators)
- Signature collection details
- Parliamentary deliberations and votes
- Party recommendations (Parteiparolen)
- **Pre-extracted brochure texts** (DE/FR/IT)
- Official PDF links
- Campaign finance information

---

## ğŸ› ï¸ Implementation Progress

### âœ… Step 1: Infrastructure (COMPLETE)

- [x] Docker Compose with 4 services
- [x] FastAPI backend with health checks
- [x] OpenWebUI frontend container
- [x] ChromaDB vector store
- [x] PostgreSQL database (local dev)
- [x] Configuration management
- [x] Documentation

### ğŸ”„ Step 2: Data & RAG Pipeline (IN PROGRESS)

- [ ] PostgreSQL schema and models
- [ ] Data migration from JSON to database
- [ ] ChromaDB collection initialization
- [ ] Brochure text embedding and indexing
- [ ] LangChain RAG pipeline
- [ ] API endpoints implementation

### ğŸ”œ Step 3: LLM Integration (PENDING)

- [ ] Swisscom Apertus API client
- [ ] OpenWebUI Pipeline implementation
- [ ] Prompt engineering for Swiss voting
- [ ] Streaming response support
- [ ] Multilingual query handling
- [ ] End-to-end testing

---

## ğŸ“– API Documentation

### REST Endpoints

| Endpoint | Method | Status | Description |
|----------|--------|--------|-------------|
| `/health` | GET | âœ… | Health check |
| `/api/initiatives` | GET | ğŸ”œ | List all initiatives |
| `/api/initiatives/{id}` | GET | ğŸ”œ | Get by ID |
| `/api/search` | POST | ğŸ”œ | Keyword search |
| `/api/rag/query` | POST | ğŸ”œ | RAG-enabled search |
| `/v1/chat/completions` | POST | ğŸ”œ | OpenAI-compatible chat |
| `/v1/models` | GET | âœ… | List models |

**Interactive Docs**: http://localhost:8000/docs

---

## ğŸ³ Docker Commands

```bash
# Start all services
docker-compose up -d

# View logs (all services)
docker-compose logs -f

# View logs (specific service)
docker-compose logs -f backend

# Restart service
docker-compose restart backend

# Stop all services
docker-compose down

# Rebuild after code changes
docker-compose up -d --build

# Reset everything (WARNING: deletes data)
docker-compose down -v
```

---

## ğŸ” Environment Variables

| Variable | Description | Required |
|----------|-------------|----------|
| `APERTUS_API_KEY` | Swisscom API key | âœ… Yes |
| `DATABASE_URL` | PostgreSQL connection | Yes |
| `CHROMADB_HOST` | ChromaDB hostname | No (default: chromadb) |
| `LOG_LEVEL` | Logging level | No (default: info) |
| `ENVIRONMENT` | dev/production | No (default: development) |

See [.env.example](.env.example) for full list.

---

## ğŸ§ª Testing

```bash
# Run setup verification
./test-setup.sh

# Test health endpoint
curl http://localhost:8000/health

# Test chat endpoint (when Step 3 complete)
curl -X POST http://localhost:8000/v1/chat/completions \
  -H "Content-Type: application/json" \
  -d '{
    "messages": [
      {"role": "user", "content": "Was ist Initiative 681?"}
    ]
  }'
```

---

## ğŸ“š Documentation

- **[SETUP.md](SETUP.md)** - Comprehensive setup guide
- **[STEP1-COMPLETE.md](STEP1-COMPLETE.md)** - Infrastructure completion
- **[API Docs](http://localhost:8000/docs)** - Interactive API documentation

---

## ğŸ¤ Migration from MCP Version

This standalone version replaces the previous MCP server implementation:

| Aspect | MCP Version | Standalone Version |
|--------|-------------|-------------------|
| Interface | stdio/HTTP | Web UI (OpenWebUI) |
| Backend | FastMCP | FastAPI |
| Data Access | GitHub JSON | PostgreSQL + ChromaDB |
| LLM | Client-side | Swisscom Apertus |
| RAG | None | LangChain + ChromaDB |
| Deployment | Single script | Docker Compose |

The legacy MCP implementation is preserved in `servers/swiss-voting/` for reference.

---

## ğŸ”— Links

- **Swissvotes**: https://swissvotes.ch
- **Swiss Admin**: https://www.admin.ch
- **Swisscom Apertus**: https://apertus.swisscom.com
- **OpenWebUI**: https://openwebui.com
- **LangChain**: https://langchain.com

---

## ğŸ“„ License

Copyright (c) 2025 Sabine Wildemann

Open source under MIT License. Free to use for everyone.
Built for Swiss civic engagement ğŸ‡¨ğŸ‡­

---

## ğŸ™ Acknowledgments

- **swissvotes.ch** for comprehensive voting data
- **Swisscom** for Apertus 70B API access
- **OpenWebUI** for excellent frontend framework
- Swiss democratic tradition of transparency

---

**Made with â¤ï¸ for informed voting decisions**
